{% extends 'template_base.html.twig' %}

{% set disabled_rank = (is_granted("IS_AUTHENTICATED")) ? false : true %}

{% block body %}
    <div class="podium">
        <div class="row goodness">
            <div class="col-xl-6 col-sm-12">
                <div class="place gold">
                    {% set goodness = podium_list[0] %}
                    {% include 'goodness/partial/podium.html.twig' %}
                </div>
            </div>
            <div class="col-xl-6 col-sm-12">
                <div class="place silver">
                    {% set goodness = podium_list[1] %}
                    {% include 'goodness/partial/podium.html.twig' %}
                </div>
                <div class="place bronze">
                    {% set goodness = podium_list[2] %}
                    {% include 'goodness/partial/podium.html.twig' %}
                </div>
            </div>
        </div>
    </div>
    <div class="ranking">
        {% for goodness in goodness_list %}
            <div class="row goodness">
                <div class="col-xl-1 col-sm-2 score" >
                    {% include 'goodness/partial/score.html.twig' %}
                </div>

                {% set goodness_scoring = 'none' %}
                {% if vote_list[goodness.getId()] is defined %}
                    {% set goodness_scoring = vote_list[goodness.getId()].name %}
                {% endif %}

                <div class="col-xl-1 col-sm-2 rank {% if disabled_rank %}disabled{% endif %}" >
                    <input type="hidden" class="goodness_id" value="{{ goodness.getId() }}">

                    {% for case in enum_cases('App\\Model\\VoteScoringEnum') %}
                        <div class="{{ case.name | lower }} {% if goodness_scoring == case.name %}active{% endif %}" value="{{ case.name }}">
                            {% include 'svg_icon/medal.html.twig' %}
                        </div>
                    {% endfor %}
                </div>

                <div class="col-xl-3 col-sm-8 info">
                    <div class="name">
                        {{ goodness.getName() }}
                    </div>
                    <div class="type">
                        {{ goodness.getTypeLabel() }}
                        <div class="type_icon">{{ goodness.getTypeIcon() | raw }}</div>
                    </div>
                </div>
                <div class="col-xl-5 col-sm-8 desc">
                    {{ goodness.getDescription() }}
                </div>
                
                <div class="col-xl-2 col-sm-4 icon">
                    <img src="{{ asset('uploads/goodness_icon/' ~ goodness.icon ) }}" >
                </div>
            </div>
        {% endfor %}
    </div>

    <script>
        $(document).ready(function() {
            
            $('.goodness').on('click', '.rank > div', function() {
                var form = $(this).parents('.rank');
                var div = $(this);

                var params = {
                    'goodness_id': form.find('.goodness_id').val(),
                    'scoring_name': div.attr('value')
                }

                $.ajax({
                    url: '{{ path("vote_goodness") }}',
                    method: "POST",
                    data: params,
                    dataType: 'json',
                    success: function(response) {
                        if (response.status == 'success') {
                            form.find('div').removeClass('active');
                            div.addClass('active');
                        }
                    }
                });
            });

        });
    </script>
{% endblock %}
